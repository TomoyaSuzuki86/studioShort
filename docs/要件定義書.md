# 機能要件定義書：ショート学習アプリ

## 1. 概要

本ドキュメントは、AIを活用した汎用的なショート動画風の学習Webアプリケーション「ショート学習アプリ」の機能要件を定義する。  
本アプリは、ユーザーが検索によって自由に学習テーマを設定でき、AIが動的に生成するショート動画風のカードで学習を進めることができる。また、プレイリスト機能によって知識を整理・蓄積し、継続的かつパーソナライズされた学習体験を提供することを目的とする。

## 2. コア機能

### 2.1. 検索主導の学習体験

- **初期画面**: アプリ起動時には、まず検索画面が表示される。
- **トピック検索**: ユーザーが学習したい単元（例：「JavaScriptの基礎」「家庭菜園のコツ」）を自由に入力して検索する。
- **検索履歴**: 過去の検索キーワードは履歴として一覧表示され、ワンタップで学習を再開できる。

### 2.2. AIによる動的・無限カード生成

- **初回生成**: 検索されたテーマに基づき、AIが初期表示用の学習カードを10件生成する。
- **無限スクロール**: 学習中に最後のカードに近づくと（残り2枚）、AIがバックグラウンドで同じテーマの新しいカードを3件追加生成する。これにより、ユーザーは無限に学習を継続できる。

### 2.3. ショート動画風UIによる学習

- **操作**: ユーザーは画面を上下にスワイプすることで学習カードを直感的に切り替える。
    - **上スワイプ**: 次の学習カードへ進む。
    - **下スワイプ**: 前の学習カードへ戻る。
- **UI**: 1画面に1つの学習トピック（カード）を全画面で表示し、情報に集中させる。

### 2.4. プレイリスト機能による知識の整理

- **機能**: 各カードの「イイネ」（ハートアイコン）ボタンをタップすると、保存先のプレイリストを選択する画面が表示される。
- **複数登録**: 1つのカードを複数のプレイリストに同時に登録できる。
- **新規作成**: プレイリスト選択画面から、新しいプレイリストをその場で作成できる。
- **一覧表示**: 「プレイリスト」タブでは、作成したプレイリストが一覧表示される。各プレイリストをタップすると、そこに含まれるカードだけを集中して見返すことができる。

### 2.5. AIによるコード詳細解説

- **トリガー**: 学習カード内にコードスニペットが存在する場合、「✨ AIで詳しく解説」ボタンが表示される。
- **機能**: ボタンをクリックするとモーダルが開き、AIが対象のコードを初心者向けに一行ずつ丁寧に解説する。

## 3. 画面とナビゲーション

### 3.1. 検索ホーム画面

- **構成**: 検索バーと検索履歴リストで構成される。アプリの起動画面となる。

### 3.2. メイン学習画面

- **構成**: ヘッダー、コンテンツ表示エリア、タブバーで構成される。
    - **ヘッダー**: ホーム（検索画面）に戻るアイコン、現在の学習トピック名、AIによるカード追加中のインジケーターを表示。
    - **コンテンツ**: 学習カードを中央に表示。

### 3.3. プレイリスト画面

- **アクセス**: タブバーの「プレイリスト」をタップして表示。
    - **第1階層**: 作成したプレイリストの一覧（プレイリスト名とカード枚数）を表示。
    - **第2階層**: 特定のプレイリストをタップすると、そのプレイリストに含まれるカードの一覧を表示する。

## 4. データ管理

### 4.1. カードデータ

- **データ構造**: `{ id, title, point, detail?, code? }` の形式を持つオブジェクト。
- **管理**: 全てのカードデータは、ユニークなIDをキーとするMapオブジェクト (`allCards`) で一元管理される。

### 4.2. データ永続化

#### 4.2.1. データベース保存 (Cloud Firestore)

- **保存対象**:
    - `playlists`: ユーザーが作成したプレイリストの情報。プレイリスト名をキーとし、それに含まれるカードIDのセットを値とするMap形式で、ユーザーIDに紐付けて保存される。
- **媒体**: Google Cloud Firestore。

#### 4.2.2. ローカルストレージ保存 (Local Storage)

- **保存対象**:
    - `allCards`: AIによってセッションをまたいで生成された全カードデータ本体（Map）。
    - `searchHistory`: 検索履歴の配列。
- **媒体**: `window.localStorage` を使用。ユーザーがブラウザのキャッシュをクリアしない限りデータは保持される。

## 5. 非機能要件

### 5.1. セキュリティ

- **機密情報の管理**: データベース接続情報などの機密情報はクライアントサイドのコードに含めない。認証は安全なFirebase Authenticationサービスを利用する。
- **サーバーサイドの考慮事項**: もし本アプリがサーバーサイドを持つ構成に拡張される場合、データベース接続文字列などの機密情報は、Gitリポジトリにコミットせず、環境変数（例：`DATABASE_URL`）として管理する。
